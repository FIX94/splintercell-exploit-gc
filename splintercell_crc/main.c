// Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

#include <stdio.h>
#include <malloc.h>

int main(int argc, char *argv[])
{
	if(argc != 2) return 0;
	FILE *f = fopen(argv[1],"rb");
	fseek(f,0,SEEK_END);
	size_t fsize = ftell(f);
	if(fsize != 0x22040)
	{
		puts("No splinter cell gci!");
		fclose(f);
		return 0;
	}
	rewind(f);
	unsigned char *buf = malloc(fsize);
	fread(buf,fsize,1,f);
	fclose(f);

	unsigned short sum = 0;
	int i;
	for(i = 0x6CA0; i < 0x949E; i++)
		sum+=buf[i];
	sum = __builtin_bswap16(sum);
	memcpy(buf+0x949E, &sum, 2);

	f = fopen(argv[1],"wb");
	fwrite(buf,0x22040,1,f);
	fclose(f);
	free(buf);
	return 0;
}