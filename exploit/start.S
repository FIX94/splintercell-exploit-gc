// Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

	.section .codestart,"ax"
	.extern fbegin
	.globl _start
	
_start:
	// Disable interrupts, do NOT replace these
	// because the searcher is looking specifically
	// for this first mfmsr instruction
	mfmsr 4 ; rlwinm 4,4,0,17,15 ; mtmsr 4 ; isync

	// Set up a stack frame.
	lis 1,0x8000 ; addi 1,1,0x3000 ; li 0,0 ; stwu 0,-64(1)

	// adjust received position to be where gcc
	// configured the start position to be
	lis 4, _start@h ; ori 4, 4, _start@l
	lis 5, fbegin@h ; ori 5, 5, fbegin@l
	subf 4, 5, 4
	subf 3, 4, 3

	// Go for it!
	b _main
