// Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

	.section .start,"ax"
	.globl _start

// this function is written very weirdly
// because it is part of a string so we have
// to make sure no emtpy spaces etc are present
// or else our function gets cut off early

_start:
	clrlwi 3,0,31
	//make sure the cache is flushed out!
	li 30,0x0140
	add 4,12,30
floop:
	addic. 30,30,-0x20
	add 31,12,30
	dcbst 31,3
	bne floop
	//equal to searchstart
	addi 4,4,-0x118
	mtlr 4
	//this right here gets replaced with blr
	srwi 8,8,8
searchstart:
	//start searching
	lwz 4,0x108(12)
	//add 4 to it for loop
	addi 12,12,0x108
	addi 12,12,-0x104
	//check for lower bits of our
	//first exploit instruction
	addi 4,4,-0xA6
	clrlwi. 5,4,16
	//lower bits not equal, back to loop
	bne searchstart
	//compare for upper bits of our
	//first exploit instruction
	srwi 4,4,16
	cmplwi 4,0x7C80
	//upper bits not equal, back to loop
	bne searchstart
	//calculate start offset to
	//jump to with previous setup
	addi 3,12,0x104
	//jump to it
	mtctr 3
	bctrl
